<ng-container>
  <!-- table actions -->
  <div class="table-actions">
    <!-- refresh -->
    <div class="table-action-wrapper">
      <button mat-button (click)="reload()">
        <mat-icon>refresh</mat-icon>
        Reload
      </button>
    </div>
    <!-- bulk actions -->
    <div class="table-action-wrapper">
      <button mat-button [matMenuTriggerFor]="bulkActionMenu" [disabled]="!hasSelected()">
        <mat-icon>adjust</mat-icon>
        Bulk Actions
      </button>
      <mat-menu #bulkActionMenu="matMenu">
        <button mat-menu-item routerLink="agents/show-agents">Delete Agents</button>
        <button mat-menu-item routerLink="agents/agent-status">Activate Agents</button>
        <button mat-menu-item routerLink="agents/agent-status">Deactivate Agents</button>
        <button mat-menu-item routerLink="agents/agent-status">Edit Rack</button>
      </mat-menu>
    </div>
    <!-- export -->
    <div class="table-action-wrapper">
      <button mat-button [matMenuTriggerFor]="exportMenu" [disabled]="!hasSelected()">
        <mat-icon>file_download</mat-icon>
        Export
      </button>
      <mat-menu #exportMenu="matMenu">
        <button mat-menu-item routerLink="agents/show-agents">Excel</button>
        <button mat-menu-item routerLink="agents/agent-status">Print</button>
        <button mat-menu-item routerLink="agents/agent-status">CSV</button>
        <button mat-menu-item routerLink="agents/agent-status">Copy</button>
      </mat-menu>
    </div>
    <!-- columns -->
    <div class="table-action-wrapper">
      <button mat-button (click)="openColumnSelectionDialog()">
        <mat-icon>view_week</mat-icon>
        Columns
      </button>
    </div>
    <!-- filter -->
    <div class="table-action-wrapper right-aligned" *ngIf="isFilterable">
      <input class="mat-input" (keyup)="applyFilter()" [(ngModel)]="dataSource.filter" placeholder="filter">
    </div>
  </div>

  <!-- Table -->
  <table mat-table [dataSource]="dataSource" matSort class="hashtopolis-table">

    <div class="spinner-container" *ngIf="dataSource.loading$ | async">
      <mat-spinner></mat-spinner>
    </div>


    <!-- select column -->
    <ng-container *ngIf="isSelectable" matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox (click)="$event.stopPropagation()" (change)="toggleAll()" [checked]="isAllSelected()"
          [indeterminate]="indeterminate()" />
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox (click)="$event.stopPropagation()" (change)="toggleSelect(row)" [checked]="isSelected(row)" />
      </td>
    </ng-container>

    <!-- action column -->
    <ng-container *ngIf="hasRowAction" matColumnDef="rowAction">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element" id="rowAction">
        <action-menu [rowData]="element"></action-menu>
      </td>
    </ng-container>

    <ng-container *ngFor="let tableColumn of tableColumns" [matColumnDef]="tableColumn.name">
      <!-- if sortable column header -->
      <ng-container *ngIf="tableColumn.isSortable; else notSortable">
        <th mat-header-cell *matHeaderCellDef [mat-sort-header]="tableColumn.name"
          [arrowPosition]="tableColumn.position === 'right' ? 'before' : 'after'">
          {{tableColumn.name}}
        </th>
      </ng-container>
      <!-- else not sortable -->
      <ng-template #notSortable>
        <th mat-header-cell *matHeaderCellDef [class.text-right]="tableColumn.position === 'right'">
          {{tableColumn.name}}
        </th>
      </ng-template>
      <!-- column data -->
      <td mat-cell *matCellDef="let element" [class.text-right]="tableColumn.position === 'right'">
        <!-- Check if a render function is defined for the column -->
        <ng-container *ngIf="tableColumn.render; else defaultRender">
          <div [innerHtml]="tableColumn.render(element)"></div>
        </ng-container>
        <!-- Default rendering if no render function is defined -->
        <ng-template #defaultRender>
          {{ element[tableColumn.dataKey] }}
        </ng-template>
      </td>

    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="toggleSelect(row)"></tr>
  </table>

  <!-- Pagination -->
  <ng-container *ngIf="isPageable">
    <hr />
    <mat-paginator [length]="dataSource.totalItems" [pageSize]="dataSource.pageSize" [pageSizeOptions]="paginationSizes"
      (page)="onPageChange($event)"></mat-paginator>
  </ng-container>
</ng-container>