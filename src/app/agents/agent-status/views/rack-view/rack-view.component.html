<div class="row card-container-ag">
  <div class="col-xs-6 col-md-4 col-lg-3" *ngFor="let agent of agents | groupBy:'agentName' | sort:'asc':'agentName'">
    <div class="card card-section">
      <div class="card-header-ag text-center">
        <a>{{ agent.k | shortenString:15 }} </a>
      </div>
      <div class="card-body" *ngFor="let a of agent.value ; let last=last">
        <div class="row">
          <small>
            <b>
              <a class="display-col" [routerLink]="['/agents/show-agents',a.agentId,'edit']">
                {{ a.agentName | split:'-':1 | shortenString:15 }}
              </a>
            </b>
          </small>
          <!-- Device Utilisation -->
          <div class="col text-center" *ngIf="statDevice | filterItem:'agentId':a.agentId | avg:'value' as result">
            <fa-icon placement="bottom" (click)="open(rackdevice)" container="body" [icon]="faDigitalTachograph"
              aria-hidden="true" class="agent-status-icon" [ngClass]="getUtilClass(result, a.isActive, a.lastTime)" />
            <br>
            <a class="display-col agent-status-link">{{ result === 'No data'? result:result +'%' }}</a>
            <!-- Modal-->
            <ng-template #rackdevice let-modal>
              <div class="modal-header">
                <h4 class="modal-title" id="modal-basic-title">
                  <fa-icon [icon]="faDigitalTachograph" aria-hidden="true"></fa-icon>
                  Device Utilisation -
                  <span [ngClass]="getUtilClass(result, a.isActive, a.lastTime)">&#9673;</span>
                  {{ result === 'No data'? result:result +'%' }}
                </h4>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <status-param-group okMessage="Device utilisation is good (&gt;= {{ utilThreshold1 }})"
                    warningMessage="Device utilisation is acceptable ( &gt;= {{ utilThreshold2 }})"
                    criticalMessage="Device utilisation is too low ( &lt; {{ utilThreshold2 }})" />
                </div>
              </div>
              <div class="modal-footer">
                <form>
                  <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Ok</button>
                </form>
              </div>
            </ng-template>
          </div>
          <!-- Temperature -->
          <div class="col text-center" *ngIf="statTemp | filterItem:'agentId':a.agentId | max:'value' as result">
            <fa-icon placement="bottom" (click)="open(racktemp)" container="body" [icon]="faTemperature0"
              aria-hidden="true" class="agent-status-icon"
              [ngClass]="getTempClass(result, a.isActive, a.lastTime)"></fa-icon>
            <br>
            <a class="display-col agent-status-link">{{ result === 'No data'? result:result +'°' }}</a>
            <!-- Modal -->
            <ng-template #racktemp let-modal>
              <div class="modal-header">
                <h4 class="modal-title" id="modal-basic-title">
                  <fa-icon [icon]="faTemperature0" aria-hidden="true"></fa-icon>
                  Temperature -
                  <span [ngClass]="getTempClass(result, a.isActive, a.lastTime)">&#9673;</span>
                  {{ result === 'No data'? result:result +'°' }}
                </h4>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <status-param-group okMessage="Device temperatures is good ( &lt;= {{ tempThreshold1 }})"
                    warningMessage="Device temperatures is acceptable ( &lt;= {{ tempThreshold2 }})"
                    criticalMessage="Device temperatures is too high ( &gt; {{ tempThreshold2 }})" />
                </div>
              </div>
              <div class="modal-footer">
                <form>
                  <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Ok</button>
                </form>
              </div>
            </ng-template>
          </div>
          <!-- GPU Utilisation -->
          <div class="col text-center" *ngIf="statCpu | filterItem:'agentId':a.agentId | avg:'value' as result">
            <fa-icon placement="bottom" (click)="open(rackcpu)" container="body" [icon]="faMicrochip" aria-hidden="true"
              class="agent-status-icon"
              [ngStyle]="{'color':result | asColor:utilThreshold1:utilThreshold2:3:a.isActive:a.lastTime}"></fa-icon>
            <br>
            <a class="display-col agent-status-link">{{ result === 'No data'? result:result +'%' }}</a>
            <!-- Modal -->
            <ng-template #rackcpu let-modal>
              <div class="modal-header">
                <h4 class="modal-title" id="modal-basic-title">
                  <fa-icon [icon]="faMicrochip" aria-hidden="true"></fa-icon> CPU
                  Utilisation - <span
                    [ngStyle]="{'color':result | asColor:utilThreshold1:utilThreshold2:3:a.isActive:a.lastTime}">&#9673;</span>
                  {{ result === 'No data'? result:result +'%' }}
                </h4>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <status-param-group okMessage="CPU utilisation is good ( &gt;= {{ utilThreshold1 }})"
                    warningMessage="CPU utilisation is acceptable ( &gt;= {{ utilThreshold2 }})"
                    criticalMessage="CPU utilisation is too low ( &lt; {{ utilThreshold2 }})" />
                </div>
              </div>
              <div class="modal-footer">
                <form>
                  <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Ok</button>
                </form>
              </div>
            </ng-template>
          </div>
          <hr *ngIf="!last" class="mt-0 mb-0 break">
        </div>
      </div>
    </div>
  </div>
</div>